import{_ as C,e as O,r as f,f as M,o as n,c as o,F as D,a,t,g,d as y,p as N,h as T}from"./main-487ad4c6.js";const w=d=>(N("data-v-0d9beffd"),d=d(),T(),d),B={class:"channel__wrapper d-flex f-center f-col w-100 h-100"},F={key:0,class:"checking-text"},R={class:"channel__info m-bottom"},A=w(()=>a("span",null,t("距離 "),-1)),z={class:"channel-name"},L=w(()=>a("span",null,t(" 上次開台已經過了"),-1)),V={class:"channel__time"},E={class:"channel__time-text m-bottom"},H={class:"channel__time-text"},J={class:"channel__care d-flex f-center m-top"},P=["href"],Z=["href"],j={key:2,class:"invalid-text d-flex f-center f-col"},q={class:"m-bottom"},G=w(()=>a("span",null,t(" 目前沒有開台紀錄"),-1)),K={key:3,class:"invalid-text d-flex f-center"},Q={key:4,class:"invalid-text d-flex f-center"},U={__name:"Channel",setup(d){const p="https://service.starknows.tw",_=O().params.channelId,v=f(null),m=f(""),b=/@[0-9a-zA-Z\_\-\.]+$/gm.test(_),s=f(null),c=f(null),k=i=>{const l=new Date-new Date(i),h=Math.floor(l/864e5),r=l%864e5,u=Math.floor(r/36e5),e=r%36e5,I=Math.floor(e/6e4),$=e%6e4,S=Math.floor($/1e3);return[h,u,I,S]},x=async i=>{if(b)try{const h=await(await fetch(`${p}/auth`,{method:"post",headers:{"Content-Type":"application/json"}})).json(),r=JSON.stringify({channelId:i}),u={"Content-Type":"application/json"};h.token&&(u.Authorization=`Bearer ${h.token}`),fetch(`${p}/api/channel-name`,{method:"post",headers:u,body:r}).then(e=>e.json()).then(e=>{console.log("channel-name: ",e),m.value=e.data}),fetch(`${p}/api/last-stream`,{method:"post",headers:u,body:r}).then(e=>{switch(e.status){case 400:return s.value="unsafe",null;case 403:return s.value="empty",null;case 404:return s.value="error",null;default:return e.json()}}).then(e=>{console.log("last-stream: ",e),e&&(s.value="valid",v.value=e.lastLiveId,c.value=k(e.data),window.setInterval(()=>{c.value=k(e.data)},1e3))})}catch(l){console.log("error: ",l)}};return M(()=>{b?x(_):s="unsafe"}),(i,l)=>(n(),o("div",B,[s.value?s.value==="valid"?(n(),o(D,{key:1},[a("div",R,[A,a("span",z,t(m.value),1),L]),a("div",V,[a("span",E,t(`${c.value[0]} 天 ${c.value[1]}時 `),1),a("span",H,t(`${c.value[2]}分 ${c.value[3]}秒`),1)]),a("div",J,[g(_)?(n(),o("a",{key:0,href:`https://www.youtube.com/${g(_)}?sub_confirmation=1`,target:"_blank",rel:"nooppener noreferrer"},t(">> 關心主播"),8,P)):y("",!0),v.value?(n(),o("a",{key:1,href:`https://www.youtube.com/watch?v=${v.value}`,target:"_blank",rel:"nooppener noreferrer"},t(">> 緬懷主播"),8,Z)):y("",!0)])],64)):s.value==="empty"?(n(),o("div",j,[a("span",q,t(m.value),1),G])):s.value==="unsafe"?(n(),o("div",K,t("頻道 ID 錯誤"))):s.value==="error"?(n(),o("div",Q,t("錯誤發生"))):y("",!0):(n(),o("div",F,"Checking..."))]))}},Y=C(U,[["__scopeId","data-v-0d9beffd"]]);export{Y as default};
